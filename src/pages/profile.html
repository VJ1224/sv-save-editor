<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Stardew Valley Save Editor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans">
    <link rel="stylesheet" href="/static/css/styles.min.css">
</head>

<body>
    <section class="login-clean" style="padding-top: 20.8px;">
        <h1 style="margin-right: 20.8px;margin-left: 20.8px;">Stardew Valley Save Editor</h1>
        <div class="container" style="margin-left: 20.8px;">
            <div class="row">
                <div class="col">
                    <p>
                        Name: {{name}} <br>
                        Farm Name: {{farmName}} <br>
                        Favourite Thing: {{favoriteThing}} <br>
                        Sex: {{sex}} <br> 
                        Animal: {{animal}} <br> <br>
                        
                        Date: {{date}} <br>
                        Playtime: {{playtime}} <br> <br>

                        Current Money: {{currentMoney}} <br>
                        Money Earned: {{moneyEarned}} <br> <br>

                        Max Health: {{maxHealth}} <br>
                        Max Stamina: {{maxStamina}} <br> <br>

                        {{#skills}}
                        Skills: <br>
                        <ul>
                        <li>Farming: {{farmingLevel}} | Exp: {{farmingExp}}</li>
                        <li>Mining: {{miningLevel}} | Exp: {{miningExp}}</li>
                        <li>Combat: {{combatLevel}} | Exp: {{combatExp}}</li>
                        <li>Foraging: {{foragingLevel}} | Exp: {{foragingExp}}</li>
                        <li>Fishing: {{fishingLevel}} | Exp: {{fishingExp}}</li>
                        </ul>
                        {{/skills}}

                        Professions: {{professions}}
                    </p>
                </div>
                <div class="col">
                    <form method="post" onsubmit="sendData(event)" id="sv-save">
                        <div class="row">
                            <div class="form-group col">
                                <label>Edit Name:</label>
                                <input class="form-control" type="text" name="name" value="{{name}}">
                            </div>

                            <div class="form-group col">
                                <label>Edit Farm Name:</label>
                                <input class="form-control" type="text" name="farmName" value="{{farmName}}">
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col">
                                <label>Edit Favourite Thing:</label>
                                <input class="form-control" type="text" name="favoriteThing" value="{{favoriteThing}}">
                            </div>
    
                            <div class="form-group col">
                                <label>Edit Money:</label>
                                <input class="form-control" type="number" name="money" value="{{currentMoney}}">
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col">
                                <label>Edit Health:</label>
                                <input class="form-control" type="number" name="health" value="{{maxHealth}}">
                            </div>
    
                            <div class="form-group col">
                                <label>Edit Stamina:</label>
                                <input class="form-control" type="number" name="stamina" value="{{maxStamina}}">
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="form-group col">
                                <label>Edit Sex:</label>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="sex" value="male"/>
                                    <label class="form-check-label" for="sv-sex1">Male</label>
                                </div>

                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="sex" value="female"/>
                                    <label class="form-check-label" for="sv-sex2">Female</label>
                                </div>
                            </div>
    
                            <div class="form-group col">
                                <label>Edit Animal:</label>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="animal" value="cat"/>
                                    <label class="form-check-label" for="sv-animal1">Cat</label>
                                </div>

                                <div class="form-check">
                                    <input type="radio" class="form-check-input" name="animal" value="dog"/>
                                    <label class="form-check-label" for="sv-animal2">Dog</label>
                                </div>
                            </div>
                        </div>

                        {{#skills}}
                        <div class="row">
                            <div class="form-group col">
                                <label>Edit Farming Lvl:</label>
                                <input class="form-control" type="number" name="farming" max="10" min="1" value="{{farmingLevel}}">
                            </div>
    
                            <div class="form-group col">
                                <label>Edit Fishing Lvl:</label>
                                <input class="form-control" type="number" name="fishing" max="10" min="1" value="{{fishingLevel}}">
                            </div>

                            <div class="form-group col">
                                <label>Edit Foraging Lvl:</label>
                                <input class="form-control" type="number" name="foraging" max="10" min="1" value="{{foragingLevel}}">
                            </div>
                        </div>

                        <div class="row">
                            <div class="form-group col">
                                <label>Edit Mining Lvl:</label>
                                <input class="form-control" type="number" name="mining" max="10" min="1" value="{{miningLevel}}">
                            </div>
    
                            <div class="form-group col">
                                <label>Edit Combat Lvl:</label>
                                <input class="form-control" type="number" name="combat" max="10" min="1" value="{{combatLevel}}">
                            </div>
                        </div>
                        {{/skills}}
                        
                        <div class="row">
                            <div class="form-group col">
                                <label>Add Profession:</label>
                                <select class="form-select" name="profession">
                                    <option disabled selected>Select</option>
                                    <option value="0">Rancher</option>
                                    <option value="1">Tiller</option>
                                    <option value="2">Coopmaster</option>
                                    <option value="3">Shepherd</option>
                                    <option value="4">Artisan</option>
                                    <option value="5">Agriculturist</option>
                                    <option value="6">Fisher</option>
                                    <option value="7">Trapper</option>
                                    <option value="8">Angler</option>
                                    <option value="9">Pirate</option>
                                    <option value="10">Mariner</option>
                                    <option value="11">Luremaster</option>
                                    <option value="12">Forester</option>
                                    <option value="13">Gatherer</option>
                                    <option value="14">Lumberjack</option>
                                    <option value="15">Tapper</option>
                                    <option value="16">Botanist</option>
                                    <option value="17">Tracker</option>
                                    <option value="18">Miner</option>
                                    <option value="19">Geologist</option>
                                    <option value="20">Blacksmith</option>
                                    <option value="21">Prospector</option>
                                    <option value="22">Excavator</option>
                                    <option value="23">Gemologist</option>
                                    <option value="24">Fighter</option>
                                    <option value="25">Scout</option>
                                    <option value="26">Brute</option>
                                    <option value="27">Defender</option>
                                    <option value="28">Acrobat</option>
                                    <option value="29">Desperado</option>
                                </select>
                            </div>
                        </div>

                        <button class="btn btn-primary d-block w-100" type="submit" style="color: var(--bs-light);background: var(--bs-red);">Submit</button>
                        <a href="/download" class="btn btn-primary d-block w-100" style="color: var(--bs-light);background: var(--bs-red);" download="{{filename}}">Download</a>
                    </form>
                </div>
            </div>
        </div>
    </section>    

    <script>
        function sendData(event) {
            event.preventDefault();
            let data = new FormData(document.querySelector("#sv-save"));

            fetch("/edit", {
                method: "POST",
                headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
                },
                body: JSON.stringify(serialize(data))
            }).then(response => {
                console.log(response);
                window.location.href = '/profile';
            });
        }

        function serialize(data) {
            let obj = {};
            for (let [key, value] of data) {
                if (obj[key] !== undefined) {
                    if (!Array.isArray(obj[key])) {
                        obj[key] = [obj[key]];
                    }
                    obj[key].push(value);
                } else {
                    obj[key] = value;
                }
            }
            return obj;
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.0.0-beta2/js/bootstrap.bundle.min.js"></script>
</body>

</html>